<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>SDK</title>
    <div th:replace="fragments/header :: header-css" th:remove="tag"/>
</head>
<body>

<section class="stage slds-grid slds-grid--vertical slds-nowrap">

    <div th:replace="fragments/header :: header">.</div>

    <div class="slds-shrink-none">
        <div class="slds-page-header"><h2 class="slds-text-heading--medium">Data Extension Details</h2></div>
    </div>
    <!--style="border: 1px solid black;"-->
    <div class="slds-box">
        <div class="slds-grid slds-grid_vertical-align-start">
            <div class="slds-size_1-of-2">
                <dl class="slds-list_horizontal slds-wrap">
                    <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Name">Name:</dt>
                    <dd class="slds-item_detail slds-truncate" title="Name">CustomerSignUpEvent</dd>
                    <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Key">EXTERNAL KEY:</dt>
                    <dd class="slds-item_detail slds-truncate" id="deKey" title="Key">
                        10A5AE1A-7A12-4E69-8D86-B74ED725F407
                    </dd>
                    <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Created Date">Created Date:
                    </dt>
                    <dd class="slds-item_detail slds-truncate" title="Created Date">30 August 2017 04:39
                    </dd>
                    <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Modified Date">Modified
                        Date:
                    </dt>
                    <dd class="slds-item_detail slds-truncate" title="Modified Date">30 August 2017 04:39
                    </dd>
                </dl>
            </div>
            <div class="slds-size_1-of-2">
                <dl class="slds-list_horizontal slds-wrap">
                    <dt class="slds-item_label slds-text-color_weak" title="USED FOR SENDING">USED FOR SENDING:</dt>
                    <dd class="slds-item_detail slds-truncate" title="USED FOR SENDING">
                        <div class="slds-truncate">Yes</div>
                        <!--<div class="slds-truncate" th:unless="${ext.isSendable}">No</div>-->
                    </dd>
                    <dt class="slds-item_label slds-text-color_weak" title="USED FOR TESTING">USED FOR TESTING:</dt>
                    <dd class="slds-item_detail slds-truncate" title="USED FOR TESTING">
                        <!--<div class="slds-truncate" th:if="${ext.isTestable}">Yes</div>-->
                        <div class="slds-truncate">No</div>
                    </dd>
                </dl>
            </div>
        </div>

    </div>
    <div>
        <a class="slds-button slds-button_brand slds-button_neutral slds-not-selected slds-m-around_medium slds-float_right"
           aria-live="assertive" id="addRecordBtn">
                                <span class="slds-text-not-selected">
                                    <svg class="slds-button__icon_stateful slds-button__icon_left" aria-hidden="true">
                                     <use xmlns:xlink="http://www.w3.org/1999/xlink"
                                          xlink:href="/styles/slds/icons/action-sprite/svg/symbols.svg#remove"></use>
                                </svg>Add Record</span>
        </a>
    </div>

    <table id="deRecords" class="slds-table slds-table_bordered slds-table_striped">
        <thead>
        <tr class="slds-text-title_caps">
            <th class="" scope="col">
                <div class="slds-truncate" title="subscriberkey">subscriberkey</div>
            </th>
            <th class="" scope="col">
                <div class="slds-truncate" title="emailaddress">emailaddress</div>
            </th>
            <th class="" scope="col">
                <div class="slds-truncate" title="date">date</div>
            </th>
            <th class="" scope="col">
                <div class="slds-truncate" title="Actions">Actions</div>
            </th>
        </tr>
        </thead>
        <tbody>
        <!--th:id="@{'extRecord_' + ${row.Id}}"-->
        <tr>
            <td class="" data-label="Key" id="extColumnValue_[10A5AE1A-7A12-4E69-8D86-B74ED725F407].[SubscriberKey]">

                <div class="slds-truncate">matrostik@gmail.com</div>

            </td>
            <td class="" data-label="Key" id="extColumnValue_[10A5AE1A-7A12-4E69-8D86-B74ED725F407].[EmailAddress]">

                <div class="slds-truncate">matrostik@gmail.com</div>

            </td>
            <td class="" data-label="Key" id="extColumnValue_[10A5AE1A-7A12-4E69-8D86-B74ED725F407].[Date]">

                <div class="slds-truncate">9/6/2017 1:19:05 PM</div>

            </td>
            <!--actions-->
            <td class="" data-label="Actions">

                <button aria-pressed="false" class="slds-button slds-button_icon" title="Copy" id="copyBtn_0" name="0">
                    <svg aria-hidden="true" class="slds-button__icon slds-icon-text-default">
                        <use xlink:href="/styles/slds/icons/action-sprite/svg/symbols.svg#clone"
                             xmlns:xlink="http://www.w3.org/1999/xlink"></use>
                    </svg>
                    <span class="slds-assistive-text">Delete</span>
                </button>
                <button aria-pressed="false" class="slds-button slds-button_icon" title="Delete" id="deleteBtn_0"
                        name="0">
                    <svg aria-hidden="true" class="slds-button__icon slds-icon-text-error">
                        <use xlink:href="/styles/slds/icons/utility-sprite/svg/symbols.svg#delete"
                             xmlns:xlink="http://www.w3.org/1999/xlink"></use>
                    </svg>
                    <span class="slds-assistive-text">Delete</span>
                </button>

            </td>
        </tr>
        <tr>
            <td class="" data-label="Key" id="extColumnValue0_[10A5AE1A-7A12-4E69-8D86-B74ED725F407].[SubscriberKey]">

                <div class="slds-truncate">matrostik@hotmail.com</div>

            </td>
            <td class="" data-label="Key" id="extColumnValue0_[10A5AE1A-7A12-4E69-8D86-B74ED725F407].[EmailAddress]">

                <div class="slds-truncate">matrostik@hotmail.com</div>

            </td>
            <td class="" data-label="Key" id="extColumnValue0_[10A5AE1A-7A12-4E69-8D86-B74ED725F407].[Date]">

                <div class="slds-truncate">9/6/2017 1:19:06 PM</div>

            </td>
            <!--actions-->
            <td class="" data-label="Actions">

                <button aria-pressed="false" class="slds-button slds-button_icon" title="Copy" id="copyBtn_1" name="1">
                    <svg aria-hidden="true" class="slds-button__icon slds-icon-text-default">
                        <use xlink:href="/styles/slds/icons/action-sprite/svg/symbols.svg#clone"
                             xmlns:xlink="http://www.w3.org/1999/xlink"></use>
                    </svg>
                    <span class="slds-assistive-text">Delete</span>
                </button>
                <button aria-pressed="false" class="slds-button slds-button_icon" title="Delete" id="deleteBtn_1"
                        name="1">
                    <svg aria-hidden="true" class="slds-button__icon slds-icon-text-error">
                        <use xlink:href="/styles/slds/icons/utility-sprite/svg/symbols.svg#delete"
                             xmlns:xlink="http://www.w3.org/1999/xlink"></use>
                    </svg>
                    <span class="slds-assistive-text">Delete</span>
                </button>

            </td>
        </tr>
        <tr>
            <td class="" data-label="Key" id="extColumnValue1_[10A5AE1A-7A12-4E69-8D86-B74ED725F407].[SubscriberKey]">
                <div class="slds-truncate">matrostik1@gmail.com</div>
            </td>
            <td class="" data-label="Key" id="extColumnValue1_[10A5AE1A-7A12-4E69-8D86-B74ED725F407].[EmailAddress]">
                <div class="slds-truncate">matrostik1@gmail.com</div>
            </td>
            <td class="" data-label="Key" id="extColumnValue1_[10A5AE1A-7A12-4E69-8D86-B74ED725F407].[Date]">
                <div class="slds-truncate">9/17/2017 5:07:45 AM</div>
            </td>
            <!--actions-->
            <td class="" data-label="Actions">

                <button aria-pressed="false" class="slds-button slds-button_icon" title="Copy" id="copyBtn_2" name="2">
                    <svg aria-hidden="true" class="slds-button__icon slds-icon-text-default">
                        <use xlink:href="/styles/slds/icons/action-sprite/svg/symbols.svg#clone"
                             xmlns:xlink="http://www.w3.org/1999/xlink"></use>
                    </svg>
                    <span class="slds-assistive-text">Delete</span>
                </button>
                <button aria-pressed="false" class="slds-button slds-button_icon" title="Delete" id="deleteBtn_2"
                        name="2">
                    <svg aria-hidden="true" class="slds-button__icon slds-icon-text-error">
                        <use xlink:href="/styles/slds/icons/utility-sprite/svg/symbols.svg#delete"
                             xmlns:xlink="http://www.w3.org/1999/xlink"></use>
                    </svg>
                    <span class="slds-assistive-text">Delete</span>
                </button>

            </td>
        </tr>
        </tbody>
    </table>

    <div th:replace="fragments/footer :: footer"></div>
</section>

<table id="templateNewRow" style="display: none">
    <tr class="row">
        <td class="slds-form-element" scope="col">
            <div class="slds-form-element  slds-p-right_x-small">
                <abbr class="slds-required" title="required">*</abbr>
                <input class="slds-input" type="text" placeholder="subscriberkey" title="subscriberkey"
                       name="subscriberkey" valuetype="TEXT">
            </div>
        </td>
        <td class="" scope="col">
            <div class="slds-form-element  slds-p-right_x-small">
                <input class="slds-input" type="text" placeholder="emailaddress" title="emailaddress"
                       name="emailaddress" valuetype="EMAIL_ADDRESS">
            </div>
        </td>
        <td class="" scope="col">
            <div class="slds-form-element  slds-p-right_x-small">
                <input class="slds-input" type="text" placeholder="date" title="date" name="date" valuetype="DATE">
            </div>
        </td>
        <!--Actions-->
        <td class="" data-label="Actions">
            <button aria-pressed="false" class="slds-button slds-button_icon" title="Save" id="saveRowTempBtn" name="0">
                <svg aria-hidden="true" class="slds-button__icon slds-icon-text-default">
                    <use xlink:href="/styles/slds/icons/action-sprite/svg/symbols.svg#approval"
                         xmlns:xlink="http://www.w3.org/1999/xlink"></use>
                </svg>
                <span class="slds-assistive-text">Save</span>
            </button>
            <button aria-pressed="false" class="slds-button slds-button_icon" title="Cancel" id="cancelRowTempBtn"
                    name="0">
                <svg aria-hidden="true" class="slds-button__icon slds-icon-text-error">
                    <use xlink:href="/styles/slds/icons/action-sprite/svg/symbols.svg#remove"
                         xmlns:xlink="http://www.w3.org/1999/xlink"></use>
                </svg>
                <span class="slds-assistive-text">Cancel</span>
            </button>

        </td>
    </tr>
</table>

<table id="templateViewRow" style="display: none">
    <tr class="row">
        <td class="slds-form-element" scope="col">
            <div class="slds-truncate" name="subscriberkey" title="subscriberkey">subscriberkey</div>
        </td>
        <td class="slds-form-element" scope="col">
            <div class="slds-truncate" name="emailaddress" title="emailaddress">emailaddress</div>
        </td>
        <td class="slds-form-element" scope="col">
            <div class="slds-truncate" name="date" title="date">date</div>
        </td>
        <!--Actions-->
        <td class="" data-label="Actions">

            <button aria-pressed="false" class="slds-button slds-button_icon" title="Copy">
                <svg aria-hidden="true" class="slds-button__icon slds-icon-text-default">
                    <use xlink:href="/styles/slds/icons/action-sprite/svg/symbols.svg#clone" xmlns:xlink="http://www.w3.org/1999/xlink"></use>
                </svg>
                <span class="slds-assistive-text">Clone</span>
            </button>
            <button aria-pressed="false" class="slds-button slds-button_icon" title="Delete">
                <svg aria-hidden="true" class="slds-button__icon slds-icon-text-error">
                    <use xlink:href="/styles/slds/icons/utility-sprite/svg/symbols.svg#delete" xmlns:xlink="http://www.w3.org/1999/xlink"></use>
                </svg>
                <span class="slds-assistive-text">Delete</span>
            </button>

        </td>
    </tr>
</table>

<script src="/webjars/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript">
    j$ = jQuery.noConflict();

    /**
     * Add new record form
     */
    j$('#addRecordBtn').click(function () {
        console.log('add clicked');
        if (isDisabled(this))
            return;
        j$(this).attr("disabled", "");
        createRowTemplate();
    });

    /**
    * Cancel record creation
    */
    j$('#deRecords').on('click', '#cancelRowBtn', function () {
        console.log("cancelRowBtn");
        j$('table#deRecords > tbody tr:first').remove();
        j$('#addRecordBtn').removeAttr('disabled');
    });

    /**
     * Save new record
     */
    j$('#deRecords').on('click', '#saveRowBtn', function () {
        console.log("saveRowBtn");
        // get de key
        var key = j$('#deKey').text().trim();
        // get columns
        var dataObject = new Map();
        j$("#extNewRow :input.slds-input").each(function (index, element) {
            dataObject[j$(this).attr('name')] = j$(this).val();
        });
        createRow(key, JSON.stringify(dataObject));
    });

    /**
     * Create new row template
     */
    function createRowTemplate() {
        var temp = j$("#templateNewRow tr.row").clone();
        temp.attr("id", "extNewRow");
        var btnSave = temp.find('#saveRowTempBtn');
        btnSave.attr("id", "saveRowBtn");
        var btnCancel = temp.find('#cancelRowTempBtn');
        btnCancel.attr("id", "cancelRowBtn");
        j$(temp).prependTo("table#deRecords > tbody");
    }

    /**
     * Post to controller amd handle result
     */
    function createRow(key, dataObject) {
        j$.ajax({
            url: "/api/sdk/create/" + key,
            type: 'POST',
            data: dataObject,
            dataType: 'json',
            contentType: "application/json",
            success: function (res) {
                console.log("it works! " + JSON.stringify(res));
                var columns = res.columns;
                // remove template row
                j$('table#deRecords > tbody tr:first').remove();
                j$('#addRecordBtn').removeAttr('disabled');
                // add row
                var view = j$("#templateViewRow tr.row").clone();
                view.attr("id", "extViewRow");
                j$(view).prependTo("table#deRecords > tbody");
                j$("#extViewRow div.slds-truncate").each(function (index, element) {
                    j$(this).text(columns[j$(this).attr('name')]);
                });
                j$("#extViewRow").removeAttr("id");
            },
            error: function (res) {
                console.log(res);
                console.log("Bad thing happend! " + JSON.stringify(res));
            }
        });
    }

    /**
     * Checks if element has disable attribute
     * @param element
     */
    function isDisabled(element) {
        var attr = j$(element).attr('disabled');
        if (typeof attr !== typeof undefined && attr !== false) {
            return true;
        }
        return false;
    }
</script>

</body>
</html>